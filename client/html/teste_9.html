<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Yield ‚Äî An√°lise Fundamentalista</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,700;1,400&family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500&family=DM+Mono:wght@300;400&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
:root {
  --bg: #0c0b0a;
  --bg-surf: #111009;
  --bg-card: #181613;
  --bg-hover: #1e1c18;
  --glass: rgba(20,18,14,0.82);
  --b: rgba(255,255,255,0.065);
  --bw: rgba(196,154,108,0.18);
  --tx: #ede8e0;
  --tx2: #968e83;
  --tx3: #524d47;
  --gold: #c49a6c;
  --gold-d: rgba(196,154,108,0.11);
  --gold-d2: rgba(196,154,108,0.18);
  --terra: #bf6649;
  --terra-d: rgba(191,102,73,0.1);
  --green: #7aac88;
  --red: #bf7a6a;
  --sidebar: 390px;
  --nav-h: 54px;
}
html { font-size: 16.1px; scroll-behavior: smooth; }
body { background: var(--bg); color: var(--tx); font-family: 'DM Sans', sans-serif; min-height: 100vh; overflow-x: hidden; }
body::before { content:''; position:fixed; inset:0; background:url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.025'/%3E%3C/svg%3E"); pointer-events:none; z-index:0; }

/* ‚îÄ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ‚îÄ */
.app { display:flex; flex-direction:column; min-height:100vh; position:relative; z-index:1; }

/* NAV */
.nav { height:var(--nav-h); display:flex; align-items:center; justify-content:space-between; padding:0 28px; border-bottom:1px solid var(--b); background:rgba(12,11,10,0.92); backdrop-filter:blur(14px); position:sticky; top:0; z-index:200; }
.nav-logo { font-family:'Playfair Display',serif; font-size:1.15rem; color:var(--gold); letter-spacing:.1em; }
.breadcrumb { display:flex; align-items:center; gap:7px; font-size:.78rem; color:var(--tx3); }
.breadcrumb span { color:var(--tx2); }
.nav-r { display:flex; gap:10px; }
.btn { background:transparent; border:1px solid var(--b); color:var(--tx2); padding:6px 14px; border-radius:7px; font-size:.78rem; cursor:pointer; font-family:'DM Sans',sans-serif; transition:all .2s; white-space:nowrap; }
.btn:hover { border-color:var(--bw); color:var(--tx); }
.btn-gold { border-color:var(--bw); color:var(--gold); background:var(--gold-d); }
.btn-gold:hover { background:var(--gold-d2); }

/* MAIN */
.main { display:flex; flex:1; transition:padding-right .38s cubic-bezier(.4,0,.2,1); }
.main.open { padding-right:var(--sidebar); }
.content { flex:1; padding:30px 36px; min-width:0; }

/* ASSET HEADER */
.asset-hd { display:flex; align-items:flex-start; justify-content:space-between; margin-bottom:30px; padding-bottom:24px; border-bottom:1px solid var(--b); gap:20px; }
.asset-left { display:flex; flex-direction:column; gap:7px; }
.ticker { font-family:'Playfair Display',serif; font-size:2.5rem; font-weight:700; line-height:1; }
.asset-name { font-size:.88rem; color:var(--tx2); font-weight:300; }
.tags { display:flex; gap:7px; margin-top:2px; }
.tag { padding:3px 10px; border-radius:20px; font-size:.68rem; font-weight:500; letter-spacing:.05em; text-transform:uppercase; border:1px solid; }
.tag-s { border-color:var(--bw); color:var(--gold); background:var(--gold-d); }
.tag-t { border-color:rgba(122,172,136,.22); color:var(--green); background:rgba(122,172,136,.08); }
.asset-right { text-align:right; flex-shrink:0; }
.price { font-family:'Playfair Display',serif; font-size:1.9rem; }
.chg { font-size:.82rem; margin-top:3px; }
.chg.up { color:var(--green); } .chg.dn { color:var(--red); }
.pdate { font-size:.7rem; color:var(--tx3); margin-top:5px; }

/* COMPARE BANNER */
.compare-banner { display:none; margin-bottom:20px; padding:12px 16px; background:var(--bg-card); border:1px solid var(--bw); border-radius:10px; align-items:center; justify-content:space-between; gap:12px; }
.compare-banner.visible { display:flex; }
.compare-info { display:flex; align-items:center; gap:14px; }
.compare-ticker-badge { font-family:'Playfair Display',serif; font-size:1.1rem; color:var(--gold); }
.compare-label { font-size:.75rem; color:var(--tx2); }
.compare-close { background:transparent; border:none; color:var(--tx3); cursor:pointer; font-size:1rem; padding:2px 6px; transition:color .2s; }
.compare-close:hover { color:var(--red); }

/* SECTION */
.section { margin-bottom:22px; }
.sec-hd { display:flex; align-items:center; justify-content:space-between; padding:13px 18px; background:var(--bg-card); border:1px solid var(--b); border-radius:10px 10px 0 0; cursor:pointer; transition:background .15s; user-select:none; }
.sec-hd:hover { background:var(--bg-hover); }
.sec-hd.collapsed { border-radius:10px; }
.sec-title { font-size:.75rem; font-weight:500; letter-spacing:.1em; text-transform:uppercase; color:var(--tx2); }
.sec-arr { color:var(--tx3); font-size:.65rem; transition:transform .25s; }
.sec-arr.open { transform:rotate(180deg); }
.sec-body { background:var(--bg-surf); border:1px solid var(--b); border-top:none; border-radius:0 0 10px 10px; overflow:hidden; }

/* METRICS GRID */
.mgrid { display:grid; grid-template-columns:repeat(4, 1fr); }
.metric-cell { padding:20px 18px; border-right:1px solid var(--b); border-bottom:1px solid var(--b); position:relative; transition:background .15s; }
.metric-cell:hover { background:var(--bg-card); }
.metric-cell:hover .mann { opacity:1; }
.metric-cell:hover .minfo { opacity:1; }
.mlbl { font-size:.68rem; color:var(--tx3); letter-spacing:.07em; text-transform:uppercase; margin-bottom:7px; display:flex; align-items:center; gap:5px; }
.mval { font-family:'DM Mono',monospace; font-size:1.22rem; color:var(--tx); }
.mval.pos { color:var(--green); } .mval.neg { color:var(--red); } .mval.neu { color:var(--gold); }
.msub { font-size:.68rem; color:var(--tx3); margin-top:3px; }

/* COMPARE VALUE */
.mval-compare { font-family:'DM Mono',monospace; font-size:.82rem; color:var(--tx3); margin-top:4px; border-top:1px solid var(--b); padding-top:4px; display:none; }
.mval-compare.visible { display:block; }
.mval-compare-ticker { font-size:.62rem; color:var(--tx3); text-transform:uppercase; letter-spacing:.05em; }

/* ICONS */
.mann { position:absolute; top:9px; right:30px; width:22px; height:22px; background:var(--gold-d); border:1px solid var(--bw); border-radius:4px; display:flex; align-items:center; justify-content:center; cursor:pointer; opacity:0; transition:opacity .15s,background .15s; font-size:.62rem; color:var(--gold); }
.mann:hover { background:var(--gold-d2); }
.minfo { position:absolute; top:9px; right:6px; width:22px; height:22px; display:flex; align-items:center; justify-content:center; cursor:pointer; opacity:0; transition:opacity .15s; font-size:.7rem; color:var(--tx3); }
.minfo:hover { color:var(--gold); }

/* ANNOTATION */
.mnote { margin-top:8px; padding:7px 9px; background:rgba(196,154,108,.06); border:1px solid var(--bw); border-radius:6px; display:none; }
.mnote.visible { display:block; }
.mnote textarea { width:100%; background:transparent; border:none; color:var(--gold); font-family:'DM Sans',sans-serif; font-size:.76rem; font-style:italic; resize:none; outline:none; min-height:36px; }

/* CHART TOGGLE */
.chart-toggle-row { padding:8px 18px 10px; border-top:1px solid var(--b); display:flex; align-items:center; gap:10px; }
.chart-toggle-btn { background:transparent; border:1px solid var(--b); border-radius:6px; padding:4px 11px; font-size:.7rem; color:var(--tx3); cursor:pointer; font-family:'DM Sans',sans-serif; transition:all .2s; letter-spacing:.03em; }
.chart-toggle-btn:hover, .chart-toggle-btn.active { border-color:var(--bw); color:var(--gold); }
.chart-period-sel { display:none; align-items:center; gap:6px; }
.chart-period-sel.visible { display:flex; }
.period-btn { background:transparent; border:1px solid var(--b); border-radius:5px; padding:3px 9px; font-size:.68rem; color:var(--tx3); cursor:pointer; font-family:'DM Sans',sans-serif; transition:all .15s; }
.period-btn.active { border-color:var(--bw); color:var(--gold); background:var(--gold-d); }
.period-sep { color:var(--tx3); font-size:.65rem; }
.year-sel { background:var(--bg-card); border:1px solid var(--b); border-radius:5px; padding:3px 8px; font-size:.68rem; color:var(--tx2); cursor:pointer; font-family:'DM Sans',sans-serif; outline:none; }

/* CHART AREA */
.chart-area { display:none; padding:14px 18px 18px; border-top:1px solid var(--b); }
.chart-area.visible { display:block; }
.chart-wrap { position:relative; height:120px; }
.chart-svg { width:100%; height:100%; overflow:visible; }

/* TOOLTIP */
.chart-tooltip { position:absolute; background:var(--bg-card); border:1px solid var(--bw); border-radius:7px; padding:8px 11px; pointer-events:none; display:none; z-index:50; min-width:130px; }
.ct-date { font-size:.68rem; color:var(--tx3); margin-bottom:3px; }
.ct-val { font-family:'DM Mono',monospace; font-size:.9rem; color:var(--tx); }
.ct-chg { font-size:.7rem; margin-top:2px; }
.ct-chg.pos { color:var(--green); } .ct-chg.neg { color:var(--red); }

/* SIDEBAR */
.sidebar { position:fixed; top:var(--nav-h); right:0; bottom:0; width:var(--sidebar); background:var(--glass); backdrop-filter:blur(28px); border-left:1px solid var(--b); display:flex; flex-direction:column; transform:translateX(100%); transition:transform .38s cubic-bezier(.4,0,.2,1); z-index:150; }
.sidebar.open { transform:translateX(0); }
.stoggle { position:fixed; top:50%; right:0; transform:translateY(-50%); width:24px; height:56px; background:var(--bg-card); border:1px solid var(--b); border-right:none; border-radius:7px 0 0 7px; display:flex; align-items:center; justify-content:center; cursor:pointer; z-index:160; color:var(--tx3); font-size:.72rem; transition:right .38s cubic-bezier(.4,0,.2,1),color .2s,background .2s; }
.stoggle:hover { color:var(--gold); }
.stoggle.open { right:var(--sidebar); }

/* SIDEBAR TABS */
.stabs { display:flex; border-bottom:1px solid var(--b); flex-shrink:0; }
.stab { flex:1; padding:13px 0; text-align:center; font-size:.72rem; letter-spacing:.07em; text-transform:uppercase; color:var(--tx3); cursor:pointer; border-bottom:2px solid transparent; transition:all .2s; }
.stab.active { color:var(--gold); border-bottom-color:var(--gold); }

.spanel { display:none; flex:1; flex-direction:column; overflow:hidden; min-height:0; }
.spanel.active { display:flex; }

/* NOTES PANEL */
.notes-list { flex:1; overflow-y:auto; padding:14px; display:flex; flex-direction:column; gap:9px; }
.note-card { background:var(--bg-card); border:1px solid var(--b); border-radius:8px; padding:11px 13px; }
.note-origin { font-size:.65rem; color:var(--gold); text-transform:uppercase; letter-spacing:.06em; margin-bottom:5px; font-family:'DM Mono',monospace; }
.note-text { font-size:.8rem; color:var(--tx2); line-height:1.55; }
.notes-empty { flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; color:var(--tx3); font-size:.8rem; text-align:center; gap:7px; padding:28px; }
.notes-empty-ico { font-size:1.6rem; opacity:.3; }
.notes-foot { padding:13px 14px; border-top:1px solid var(--b); flex-shrink:0; display:flex; flex-direction:column; gap:8px; }
.ai-sum-block { padding:12px 13px; background:var(--gold-d); border:1px solid var(--bw); border-radius:8px; font-size:.78rem; color:var(--tx2); line-height:1.6; display:none; }
.ai-sum-block.visible { display:block; animation:fadein .3s ease; }
.ai-sum-lbl { font-size:.63rem; text-transform:uppercase; letter-spacing:.08em; color:var(--gold); margin-bottom:6px; }
.btn-ai { width:100%; padding:9px; background:var(--gold-d); border:1px solid var(--bw); border-radius:8px; color:var(--gold); font-family:'DM Sans',sans-serif; font-size:.78rem; cursor:pointer; transition:all .2s; }
.btn-ai:hover { background:var(--gold-d2); }

/* ANALYSIS PANEL */
.an-head { padding:14px; border-bottom:1px solid var(--b); flex-shrink:0; }
.an-confirm { display:flex; align-items:center; gap:10px; padding:9px 11px; background:var(--bg-card); border:1px solid var(--bw); border-radius:8px; margin-bottom:10px; }
.an-ticker { font-family:'Playfair Display',serif; font-size:.95rem; color:var(--gold); }
.an-cname { font-size:.7rem; color:var(--tx3); }
.an-name-inp { width:100%; background:var(--bg-card); border:1px solid var(--b); border-radius:7px; padding:8px 11px; color:var(--tx); font-family:'DM Sans',sans-serif; font-size:.82rem; outline:none; transition:border-color .2s; }
.an-name-inp:focus { border-color:var(--bw); }
.an-name-inp::placeholder { color:var(--tx3); }
.an-body { flex:1; overflow-y:auto; padding:0 14px 14px; display:flex; flex-direction:column; gap:10px; min-height:0; }
.an-editor { flex:1; background:var(--bg-card); border:1px solid var(--b); border-radius:8px; padding:12px; color:var(--tx); font-family:'DM Sans',sans-serif; font-size:.82rem; line-height:1.75; resize:none; outline:none; transition:border-color .2s; min-height:160px; }
.an-editor:focus { border-color:var(--bw); }
.an-editor::placeholder { color:var(--tx3); font-style:italic; }
.ai-insight { padding:11px 13px; background:var(--terra-d); border:1px solid rgba(191,102,73,.22); border-left:3px solid var(--terra); border-radius:0 7px 7px 0; font-size:.76rem; color:rgba(210,130,105,.9); line-height:1.6; animation:fadein .4s ease; display:none; }
.ai-ins-lbl { font-size:.62rem; text-transform:uppercase; letter-spacing:.08em; color:var(--terra); margin-bottom:4px; }
.an-foot { padding:0 14px 14px; display:flex; gap:7px; flex-shrink:0; }
.btn-calc { flex:0; padding:8px 13px; background:var(--bg-card); border:1px solid var(--b); border-radius:7px; color:var(--tx2); font-family:'DM Sans',sans-serif; font-size:.75rem; cursor:pointer; white-space:nowrap; transition:all .2s; }
.btn-calc:hover { border-color:var(--bw); color:var(--gold); }
.btn-save { flex:1; padding:8px; background:var(--gold-d); border:1px solid var(--bw); border-radius:7px; color:var(--gold); font-family:'DM Sans',sans-serif; font-size:.75rem; cursor:pointer; transition:all .2s; }
.btn-save:hover { background:var(--gold-d2); }

/* SAVED ANALYSES PANEL */
.saves-list { flex:1; overflow-y:auto; padding:14px; display:flex; flex-direction:column; gap:9px; }
.save-card { background:var(--bg-card); border:1px solid var(--b); border-radius:8px; padding:13px; cursor:pointer; transition:background .15s,border-color .15s; }
.save-card:hover { background:var(--bg-hover); border-color:var(--bw); }
.save-card-name { font-size:.88rem; color:var(--tx); margin-bottom:4px; }
.save-card-meta { font-size:.68rem; color:var(--tx3); display:flex; gap:10px; }
.save-card-meta span { color:var(--tx2); }
.save-card-preview { font-size:.75rem; color:var(--tx3); margin-top:7px; line-height:1.5; overflow:hidden; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; }

/* MODAL */
.modal-ov { position:fixed; inset:0; background:rgba(0,0,0,.75); backdrop-filter:blur(10px); z-index:300; display:none; align-items:center; justify-content:center; }
.modal-ov.open { display:flex; }
.modal { background:var(--bg-card); border:1px solid var(--b); border-radius:14px; padding:26px; width:540px; max-width:95vw; max-height:90vh; overflow-y:auto; animation:modalin .22s ease; }
@keyframes modalin { from{opacity:0;transform:scale(.96)} to{opacity:1;transform:scale(1)} }
@keyframes fadein { from{opacity:0;transform:translateY(5px)} to{opacity:1;transform:translateY(0)} }
.modal-title { font-family:'Playfair Display',serif; font-size:1.15rem; margin-bottom:18px; color:var(--tx); }
.calc-tabs { display:flex; gap:7px; margin-bottom:18px; flex-wrap:wrap; }
.ctab { padding:5px 13px; border-radius:20px; font-size:.72rem; cursor:pointer; border:1px solid var(--b); color:var(--tx3); transition:all .15s; }
.ctab.active { border-color:var(--bw); color:var(--gold); background:var(--gold-d); }
.calc-body { display:flex; flex-direction:column; gap:13px; }
.calc-section { display:none; }
.calc-section.active { display:flex; flex-direction:column; gap:13px; }
.cfield { display:flex; flex-direction:column; gap:4px; }
.cfield label { font-size:.68rem; color:var(--tx3); text-transform:uppercase; letter-spacing:.05em; }
.cfield input, .cfield select { background:var(--bg-surf); border:1px solid var(--b); border-radius:6px; padding:8px 10px; color:var(--tx); font-family:'DM Mono',monospace; font-size:.85rem; outline:none; transition:border-color .2s; width:100%; }
.cfield input:focus, .cfield select:focus { border-color:var(--bw); }
.cfield select option { background:var(--bg-card); }
.crow { display:grid; grid-template-columns:1fr 1fr; gap:11px; }
.cresult { padding:14px 16px; background:var(--bg-surf); border:1px solid var(--bw); border-radius:8px; text-align:center; }
.cres-lbl { font-size:.65rem; text-transform:uppercase; letter-spacing:.06em; color:var(--tx3); margin-bottom:4px; }
.cres-val { font-family:'Playfair Display',serif; font-size:1.55rem; color:var(--gold); }
.cres-sub { font-size:.72rem; color:var(--tx3); margin-top:3px; }
.modal-close { width:100%; margin-top:14px; padding:9px; background:transparent; border:1px solid var(--b); border-radius:7px; color:var(--tx3); font-family:'DM Sans',sans-serif; cursor:pointer; transition:all .2s; }
.modal-close:hover { color:var(--tx); border-color:var(--bw); }

/* INFO MODAL */
.info-modal { width:420px; }
.info-title { font-family:'Playfair Display',serif; font-size:1.05rem; color:var(--tx); margin-bottom:6px; }
.info-subtitle { font-size:.72rem; color:var(--tx3); margin-bottom:16px; text-transform:uppercase; letter-spacing:.05em; }
.info-section { margin-bottom:14px; }
.info-section-title { font-size:.68rem; text-transform:uppercase; letter-spacing:.06em; color:var(--gold); margin-bottom:5px; }
.info-text { font-size:.8rem; color:var(--tx2); line-height:1.65; }

/* COMPARE MODAL */
.comp-input { display:flex; gap:8px; margin-bottom:16px; }
.comp-input input { flex:1; background:var(--bg-surf); border:1px solid var(--b); border-radius:7px; padding:9px 12px; color:var(--tx); font-family:'DM Mono',monospace; font-size:.9rem; outline:none; transition:border-color .2s; text-transform:uppercase; }
.comp-input input:focus { border-color:var(--bw); }
.comp-input button { padding:9px 16px; background:var(--gold-d); border:1px solid var(--bw); border-radius:7px; color:var(--gold); font-family:'DM Sans',sans-serif; font-size:.78rem; cursor:pointer; transition:all .2s; }
.comp-input button:hover { background:var(--gold-d2); }

/* VALUATION CALC */
.val-model-desc { padding:11px 13px; background:var(--bg-surf); border:1px solid var(--b); border-radius:7px; font-size:.78rem; color:var(--tx2); line-height:1.6; margin-bottom:4px; }
.multi-results { display:grid; grid-template-columns:1fr 1fr; gap:9px; }
.mini-result { padding:11px; background:var(--bg-surf); border:1px solid var(--b); border-radius:7px; text-align:center; }
.mini-res-lbl { font-size:.62rem; color:var(--tx3); text-transform:uppercase; margin-bottom:3px; }
.mini-res-val { font-family:'Playfair Display',serif; font-size:1.1rem; color:var(--gold); }

::-webkit-scrollbar { width:3px; } ::-webkit-scrollbar-track { background:transparent; } ::-webkit-scrollbar-thumb { background:var(--b); border-radius:2px; }
</style>
</head>
<body>
<div class="app">

<!-- NAV -->
<nav class="nav">
  <div class="nav-logo">Yield</div>
  <div class="breadcrumb"><span>Investimentos</span><span style="opacity:.35">‚Ä∫</span><span>An√°lise Fundamentalista</span></div>
  <div class="nav-r">
    <button class="btn" onclick="openCompare()">‚áÑ Comparar</button>
    <button class="btn btn-gold" onclick="toggleSidebar()">Workspace</button>
  </div>
</nav>

<!-- MAIN -->
<div class="main" id="main">
<div class="content">

<!-- ASSET HEADER -->
<div class="asset-hd">
  <div class="asset-left">
    <div class="ticker">PETR4</div>
    <div class="asset-name">Petr√≥leo Brasileiro S.A. ‚Äî Petrobras</div>
    <div class="tags">
      <span class="tag tag-s">Energia</span>
      <span class="tag tag-t">N√£o-Banco</span>
    </div>
  </div>
  <div class="asset-right">
    <div class="price">R$ 38,42</div>
    <div class="chg up">‚ñ≤ +1,24% hoje</div>
    <div class="pdate">17 fev. 2026 ¬∑ Fechamento</div>
  </div>
</div>

<!-- COMPARE BANNER -->
<div class="compare-banner" id="compareBanner">
  <div class="compare-info">
    <div>
      <div class="compare-ticker-badge" id="compTickerBadge">VALE3</div>
      <div class="compare-label" id="compName">Vale S.A.</div>
    </div>
    <span style="font-size:.75rem;color:var(--tx3)">Compara√ß√£o ativa ‚Äî valores em it√°lico</span>
  </div>
  <button class="compare-close" onclick="removeCompare()">‚úï</button>
</div>

<!-- BLOCO VALUATION -->
<div class="section">
  <div class="sec-hd" onclick="toggleSec(this)">
    <span class="sec-title">Valuation</span>
    <span class="sec-arr open">‚ñº</span>
  </div>
  <div class="sec-body">
    <div class="mgrid">
      <div class="metric-cell" data-key="PL">
        <div class="mlbl">P/L <span class="minfo" onclick="showInfo('PL',event)">‚ìò</span></div>
        <div class="mval neu">4,8x</div>
        <div class="msub">Setor: 7,2x</div>
        <div class="mval-compare" id="cmp-PL"><span class="mval-compare-ticker" id="ct-PL"></span> ‚Äî</div>
        <div class="mann" onclick="openNote(this)">‚úé</div>
        <div class="mnote"><textarea placeholder="Sua anota√ß√£o..." rows="2" onblur="saveNote(this,'P/L')"></textarea></div>
        <div class="chart-toggle-row">
          <button class="chart-toggle-btn" onclick="toggleChart(this,'PL')">Mostrar gr√°fico</button>
          <div class="chart-period-sel" id="psel-PL">
            <button class="period-btn active" onclick="setPeriod(this,'PL','A')">Anual</button>
            <button class="period-btn" onclick="setPeriod(this,'PL','1T')">1T</button>
            <button class="period-btn" onclick="setPeriod(this,'PL','2T')">2T</button>
            <button class="period-btn" onclick="setPeriod(this,'PL','3T')">3T</button>
            <button class="period-btn" onclick="setPeriod(this,'PL','4T')">4T</button>
            <span class="period-sep">|</span>
            <select class="year-sel" onchange="setYear(this,'PL')" id="ysel-PL"></select>
          </div>
        </div>
        <div class="chart-area" id="chart-PL"><div class="chart-wrap"><svg class="chart-svg" id="svg-PL"></svg><div class="chart-tooltip" id="tip-PL"></div></div></div>
      </div>
      <div class="metric-cell" data-key="PVP">
        <div class="mlbl">P/VP <span class="minfo" onclick="showInfo('PVP',event)">‚ìò</span></div>
        <div class="mval neu">1,2x</div>
        <div class="msub">Setor: 1,8x</div>
        <div class="mval-compare" id="cmp-PVP"><span class="mval-compare-ticker" id="ct-PVP"></span> ‚Äî</div>
        <div class="mann" onclick="openNote(this)">‚úé</div>
        <div class="mnote"><textarea placeholder="Sua anota√ß√£o..." rows="2" onblur="saveNote(this,'P/VP')"></textarea></div>
        <div class="chart-toggle-row">
          <button class="chart-toggle-btn" onclick="toggleChart(this,'PVP')">Mostrar gr√°fico</button>
          <div class="chart-period-sel" id="psel-PVP">
            <button class="period-btn active" onclick="setPeriod(this,'PVP','A')">Anual</button>
            <button class="period-btn" onclick="setPeriod(this,'PVP','1T')">1T</button>
            <button class="period-btn" onclick="setPeriod(this,'PVP','2T')">2T</button>
            <button class="period-btn" onclick="setPeriod(this,'PVP','3T')">3T</button>
            <button class="period-btn" onclick="setPeriod(this,'PVP','4T')">4T</button>
            <span class="period-sep">|</span>
            <select class="year-sel" onchange="setYear(this,'PVP')" id="ysel-PVP"></select>
          </div>
        </div>
        <div class="chart-area" id="chart-PVP"><div class="chart-wrap"><svg class="chart-svg" id="svg-PVP"></svg><div class="chart-tooltip" id="tip-PVP"></div></div></div>
      </div>
      <div class="metric-cell" data-key="EVEBITDA">
        <div class="mlbl">EV/EBITDA <span class="minfo" onclick="showInfo('EVEBITDA',event)">‚ìò</span></div>
        <div class="mval neu">3,6x</div>
        <div class="msub">Setor: 5,1x</div>
        <div class="mval-compare" id="cmp-EVEBITDA"><span class="mval-compare-ticker" id="ct-EVEBITDA"></span> ‚Äî</div>
        <div class="mann" onclick="openNote(this)">‚úé</div>
        <div class="mnote"><textarea placeholder="Sua anota√ß√£o..." rows="2" onblur="saveNote(this,'EV/EBITDA')"></textarea></div>
        <div class="chart-toggle-row">
          <button class="chart-toggle-btn" onclick="toggleChart(this,'EVEBITDA')">Mostrar gr√°fico</button>
          <div class="chart-period-sel" id="psel-EVEBITDA">
            <button class="period-btn active" onclick="setPeriod(this,'EVEBITDA','A')">Anual</button>
            <button class="period-btn" onclick="setPeriod(this,'EVEBITDA','1T')">1T</button>
            <button class="period-btn" onclick="setPeriod(this,'EVEBITDA','2T')">2T</button>
            <button class="period-btn" onclick="setPeriod(this,'EVEBITDA','3T')">3T</button>
            <button class="period-btn" onclick="setPeriod(this,'EVEBITDA','4T')">4T</button>
            <span class="period-sep">|</span>
            <select class="year-sel" onchange="setYear(this,'EVEBITDA')" id="ysel-EVEBITDA"></select>
          </div>
        </div>
        <div class="chart-area" id="chart-EVEBITDA"><div class="chart-wrap"><svg class="chart-svg" id="svg-EVEBITDA"></svg><div class="chart-tooltip" id="tip-EVEBITDA"></div></div></div>
      </div>
      <div class="metric-cell" data-key="DY">
        <div class="mlbl">Dividend Yield <span class="minfo" onclick="showInfo('DY',event)">‚ìò</span></div>
        <div class="mval pos">14,3%</div>
        <div class="msub">√öltimo pag.: R$ 5,49/a√ß√£o</div>
        <div class="mval-compare" id="cmp-DY"><span class="mval-compare-ticker" id="ct-DY"></span> ‚Äî</div>
        <div class="mann" onclick="openNote(this)">‚úé</div>
        <div class="mnote"><textarea placeholder="Sua anota√ß√£o..." rows="2" onblur="saveNote(this,'DY')"></textarea></div>
        <div class="chart-toggle-row">
          <button class="chart-toggle-btn" onclick="toggleChart(this,'DY')">Mostrar gr√°fico</button>
          <div class="chart-period-sel" id="psel-DY">
            <button class="period-btn active" onclick="setPeriod(this,'DY','A')">Anual</button>
            <button class="period-btn" onclick="setPeriod(this,'DY','1T')">1T</button>
            <button class="period-btn" onclick="setPeriod(this,'DY','2T')">2T</button>
            <button class="period-btn" onclick="setPeriod(this,'DY','3T')">3T</button>
            <button class="period-btn" onclick="setPeriod(this,'DY','4T')">4T</button>
            <span class="period-sep">|</span>
            <select class="year-sel" onchange="setYear(this,'DY')" id="ysel-DY"></select>
          </div>
        </div>
        <div class="chart-area" id="chart-DY"><div class="chart-wrap"><svg class="chart-svg" id="svg-DY"></svg><div class="chart-tooltip" id="tip-DY"></div></div></div>
      </div>
    </div>
  </div>
</div>

<!-- BLOCO RENTABILIDADE -->
<div class="section">
  <div class="sec-hd" onclick="toggleSec(this)">
    <span class="sec-title">Rentabilidade</span>
    <span class="sec-arr open">‚ñº</span>
  </div>
  <div class="sec-body">
    <div class="mgrid">
      <div class="metric-cell" data-key="ROE">
        <div class="mlbl">ROE <span class="minfo" onclick="showInfo('ROE',event)">‚ìò</span></div>
        <div class="mval pos">28,4%</div>
        <div class="msub">2023: 31,2%</div>
        <div class="mval-compare" id="cmp-ROE"><span class="mval-compare-ticker" id="ct-ROE"></span> ‚Äî</div>
        <div class="mann" onclick="openNote(this)">‚úé</div>
        <div class="mnote"><textarea placeholder="Sua anota√ß√£o..." rows="2" onblur="saveNote(this,'ROE')"></textarea></div>
        <div class="chart-toggle-row">
          <button class="chart-toggle-btn" onclick="toggleChart(this,'ROE')">Mostrar gr√°fico</button>
          <div class="chart-period-sel" id="psel-ROE">
            <button class="period-btn active" onclick="setPeriod(this,'ROE','A')">Anual</button>
            <button class="period-btn" onclick="setPeriod(this,'ROE','1T')">1T</button>
            <button class="period-btn" onclick="setPeriod(this,'ROE','2T')">2T</button>
            <button class="period-btn" onclick="setPeriod(this,'ROE','3T')">3T</button>
            <button class="period-btn" onclick="setPeriod(this,'ROE','4T')">4T</button>
            <span class="period-sep">|</span>
            <select class="year-sel" onchange="setYear(this,'ROE')" id="ysel-ROE"></select>
          </div>
        </div>
        <div class="chart-area" id="chart-ROE"><div class="chart-wrap"><svg class="chart-svg" id="svg-ROE"></svg><div class="chart-tooltip" id="tip-ROE"></div></div></div>
      </div>
      <div class="metric-cell" data-key="ROIC">
        <div class="mlbl">ROIC <span class="minfo" onclick="showInfo('ROIC',event)">‚ìò</span></div>
        <div class="mval pos">18,7%</div>
        <div class="msub">2023: 20,1%</div>
        <div class="mval-compare" id="cmp-ROIC"><span class="mval-compare-ticker" id="ct-ROIC"></span> ‚Äî</div>
        <div class="mann" onclick="openNote(this)">‚úé</div>
        <div class="mnote"><textarea placeholder="Sua anota√ß√£o..." rows="2" onblur="saveNote(this,'ROIC')"></textarea></div>
        <div class="chart-toggle-row">
          <button class="chart-toggle-btn" onclick="toggleChart(this,'ROIC')">Mostrar gr√°fico</button>
          <div class="chart-period-sel" id="psel-ROIC">
            <button class="period-btn active" onclick="setPeriod(this,'ROIC','A')">Anual</button>
            <button class="period-btn" onclick="setPeriod(this,'ROIC','1T')">1T</button>
            <button class="period-btn" onclick="setPeriod(this,'ROIC','2T')">2T</button>
            <button class="period-btn" onclick="setPeriod(this,'ROIC','3T')">3T</button>
            <button class="period-btn" onclick="setPeriod(this,'ROIC','4T')">4T</button>
            <span class="period-sep">|</span>
            <select class="year-sel" onchange="setYear(this,'ROIC')" id="ysel-ROIC"></select>
          </div>
        </div>
        <div class="chart-area" id="chart-ROIC"><div class="chart-wrap"><svg class="chart-svg" id="svg-ROIC"></svg><div class="chart-tooltip" id="tip-ROIC"></div></div></div>
      </div>
      <div class="metric-cell" data-key="ROA">
        <div class="mlbl">ROA <span class="minfo" onclick="showInfo('ROA',event)">‚ìò</span></div>
        <div class="mval neu">9,2%</div>
        <div class="msub">2023: 10,5%</div>
        <div class="mval-compare" id="cmp-ROA"><span class="mval-compare-ticker" id="ct-ROA"></span> ‚Äî</div>
        <div class="mann" onclick="openNote(this)">‚úé</div>
        <div class="mnote"><textarea placeholder="Sua anota√ß√£o..." rows="2" onblur="saveNote(this,'ROA')"></textarea></div>
        <div class="chart-toggle-row">
          <button class="chart-toggle-btn" onclick="toggleChart(this,'ROA')">Mostrar gr√°fico</button>
          <div class="chart-period-sel" id="psel-ROA">
            <button class="period-btn active" onclick="setPeriod(this,'ROA','A')">Anual</button>
            <button class="period-btn" onclick="setPeriod(this,'ROA','1T')">1T</button>
            <button class="period-btn" onclick="setPeriod(this,'ROA','2T')">2T</button>
            <button class="period-btn" onclick="setPeriod(this,'ROA','3T')">3T</button>
            <button class="period-btn" onclick="setPeriod(this,'ROA','4T')">4T</button>
            <span class="period-sep">|</span>
            <select class="year-sel" onchange="setYear(this,'ROA')" id="ysel-ROA"></select>
          </div>
        </div>
        <div class="chart-area" id="chart-ROA"><div class="chart-wrap"><svg class="chart-svg" id="svg-ROA"></svg><div class="chart-tooltip" id="tip-ROA"></div></div></div>
      </div>
      <div class="metric-cell" data-key="MEBITDA">
        <div class="mlbl">Margem EBITDA <span class="minfo" onclick="showInfo('MEBITDA',event)">‚ìò</span></div>
        <div class="mval pos">54,8%</div>
        <div class="msub">Setor: 38,2%</div>
        <div class="mval-compare" id="cmp-MEBITDA"><span class="mval-compare-ticker" id="ct-MEBITDA"></span> ‚Äî</div>
        <div class="mann" onclick="openNote(this)">‚úé</div>
        <div class="mnote"><textarea placeholder="Sua anota√ß√£o..." rows="2" onblur="saveNote(this,'Margem EBITDA')"></textarea></div>
        <div class="chart-toggle-row">
          <button class="chart-toggle-btn" onclick="toggleChart(this,'MEBITDA')">Mostrar gr√°fico</button>
          <div class="chart-period-sel" id="psel-MEBITDA">
            <button class="period-btn active" onclick="setPeriod(this,'MEBITDA','A')">Anual</button>
            <button class="period-btn" onclick="setPeriod(this,'MEBITDA','1T')">1T</button>
            <button class="period-btn" onclick="setPeriod(this,'MEBITDA','2T')">2T</button>
            <button class="period-btn" onclick="setPeriod(this,'MEBITDA','3T')">3T</button>
            <button class="period-btn" onclick="setPeriod(this,'MEBITDA','4T')">4T</button>
            <span class="period-sep">|</span>
            <select class="year-sel" onchange="setYear(this,'MEBITDA')" id="ysel-MEBITDA"></select>
          </div>
        </div>
        <div class="chart-area" id="chart-MEBITDA"><div class="chart-wrap"><svg class="chart-svg" id="svg-MEBITDA"></svg><div class="chart-tooltip" id="tip-MEBITDA"></div></div></div>
      </div>
    </div>
  </div>
</div>

<!-- BLOCO RESULTADO -->
<div class="section">
  <div class="sec-hd" onclick="toggleSec(this)">
    <span class="sec-title">Resultado (R$ Bilh√µes)</span>
    <span class="sec-arr open">‚ñº</span>
  </div>
  <div class="sec-body">
    <div class="mgrid">
      <div class="metric-cell" data-key="RL">
        <div class="mlbl">Receita L√≠quida <span class="minfo" onclick="showInfo('RL',event)">‚ìò</span></div>
        <div class="mval">R$ 512,4B</div>
        <div class="msub">‚ñ≤ +3,1% a.a.</div>
        <div class="mval-compare" id="cmp-RL"><span class="mval-compare-ticker" id="ct-RL"></span> ‚Äî</div>
        <div class="mann" onclick="openNote(this)">‚úé</div>
        <div class="mnote"><textarea placeholder="Sua anota√ß√£o..." rows="2" onblur="saveNote(this,'Receita L√≠quida')"></textarea></div>
        <div class="chart-toggle-row">
          <button class="chart-toggle-btn" onclick="toggleChart(this,'RL')">Mostrar gr√°fico</button>
          <div class="chart-period-sel" id="psel-RL">
            <button class="period-btn active" onclick="setPeriod(this,'RL','A')">Anual</button>
            <button class="period-btn" onclick="setPeriod(this,'RL','1T')">1T</button>
            <button class="period-btn" onclick="setPeriod(this,'RL','2T')">2T</button>
            <button class="period-btn" onclick="setPeriod(this,'RL','3T')">3T</button>
            <button class="period-btn" onclick="setPeriod(this,'RL','4T')">4T</button>
            <span class="period-sep">|</span>
            <select class="year-sel" onchange="setYear(this,'RL')" id="ysel-RL"></select>
          </div>
        </div>
        <div class="chart-area" id="chart-RL"><div class="chart-wrap"><svg class="chart-svg" id="svg-RL"></svg><div class="chart-tooltip" id="tip-RL"></div></div></div>
      </div>
      <div class="metric-cell" data-key="LB">
        <div class="mlbl">Lucro Bruto <span class="minfo" onclick="showInfo('LB',event)">‚ìò</span></div>
        <div class="mval">R$ 286,1B</div>
        <div class="msub">Margem: 55,8%</div>
        <div class="mval-compare" id="cmp-LB"><span class="mval-compare-ticker" id="ct-LB"></span> ‚Äî</div>
        <div class="mann" onclick="openNote(this)">‚úé</div>
        <div class="mnote"><textarea placeholder="Sua anota√ß√£o..." rows="2" onblur="saveNote(this,'Lucro Bruto')"></textarea></div>
        <div class="chart-toggle-row">
          <button class="chart-toggle-btn" onclick="toggleChart(this,'LB')">Mostrar gr√°fico</button>
          <div class="chart-period-sel" id="psel-LB">
            <button class="period-btn active" onclick="setPeriod(this,'LB','A')">Anual</button>
            <button class="period-btn" onclick="setPeriod(this,'LB','1T')">1T</button>
            <button class="period-btn" onclick="setPeriod(this,'LB','2T')">2T</button>
            <button class="period-btn" onclick="setPeriod(this,'LB','3T')">3T</button>
            <button class="period-btn" onclick="setPeriod(this,'LB','4T')">4T</button>
            <span class="period-sep">|</span>
            <select class="year-sel" onchange="setYear(this,'LB')" id="ysel-LB"></select>
          </div>
        </div>
        <div class="chart-area" id="chart-LB"><div class="chart-wrap"><svg class="chart-svg" id="svg-LB"></svg><div class="chart-tooltip" id="tip-LB"></div></div></div>
      </div>
      <div class="metric-cell" data-key="EBITDA">
        <div class="mlbl">EBITDA <span class="minfo" onclick="showInfo('EBITDA',event)">‚ìò</span></div>
        <div class="mval">R$ 280,7B</div>
        <div class="msub">‚ñº -2,4% a.a.</div>
        <div class="mval-compare" id="cmp-EBITDA"><span class="mval-compare-ticker" id="ct-EBITDA"></span> ‚Äî</div>
        <div class="mann" onclick="openNote(this)">‚úé</div>
        <div class="mnote"><textarea placeholder="Sua anota√ß√£o..." rows="2" onblur="saveNote(this,'EBITDA')"></textarea></div>
        <div class="chart-toggle-row">
          <button class="chart-toggle-btn" onclick="toggleChart(this,'EBITDA')">Mostrar gr√°fico</button>
          <div class="chart-period-sel" id="psel-EBITDA">
            <button class="period-btn active" onclick="setPeriod(this,'EBITDA','A')">Anual</button>
            <button class="period-btn" onclick="setPeriod(this,'EBITDA','1T')">1T</button>
            <button class="period-btn" onclick="setPeriod(this,'EBITDA','2T')">2T</button>
            <button class="period-btn" onclick="setPeriod(this,'EBITDA','3T')">3T</button>
            <button class="period-btn" onclick="setPeriod(this,'EBITDA','4T')">4T</button>
            <span class="period-sep">|</span>
            <select class="year-sel" onchange="setYear(this,'EBITDA')" id="ysel-EBITDA"></select>
          </div>
        </div>
        <div class="chart-area" id="chart-EBITDA"><div class="chart-wrap"><svg class="chart-svg" id="svg-EBITDA"></svg><div class="chart-tooltip" id="tip-EBITDA"></div></div></div>
      </div>
      <div class="metric-cell" data-key="LL">
        <div class="mlbl">Lucro L√≠quido <span class="minfo" onclick="showInfo('LL',event)">‚ìò</span></div>
        <div class="mval">R$ 124,6B</div>
        <div class="msub">‚ñº -8,1% a.a.</div>
        <div class="mval-compare" id="cmp-LL"><span class="mval-compare-ticker" id="ct-LL"></span> ‚Äî</div>
        <div class="mann" onclick="openNote(this)">‚úé</div>
        <div class="mnote"><textarea placeholder="Sua anota√ß√£o..." rows="2" onblur="saveNote(this,'Lucro L√≠quido')"></textarea></div>
        <div class="chart-toggle-row">
          <button class="chart-toggle-btn" onclick="toggleChart(this,'LL')">Mostrar gr√°fico</button>
          <div class="chart-period-sel" id="psel-LL">
            <button class="period-btn active" onclick="setPeriod(this,'LL','A')">Anual</button>
            <button class="period-btn" onclick="setPeriod(this,'LL','1T')">1T</button>
            <button class="period-btn" onclick="setPeriod(this,'LL','2T')">2T</button>
            <button class="period-btn" onclick="setPeriod(this,'LL','3T')">3T</button>
            <button class="period-btn" onclick="setPeriod(this,'LL','4T')">4T</button>
            <span class="period-sep">|</span>
            <select class="year-sel" onchange="setYear(this,'LL')" id="ysel-LL"></select>
          </div>
        </div>
        <div class="chart-area" id="chart-LL"><div class="chart-wrap"><svg class="chart-svg" id="svg-LL"></svg><div class="chart-tooltip" id="tip-LL"></div></div></div>
      </div>
    </div>
  </div>
</div>

<!-- BLOCO ENDIVIDAMENTO -->
<div class="section">
  <div class="sec-hd" onclick="toggleSec(this)">
    <span class="sec-title">Endividamento</span>
    <span class="sec-arr open">‚ñº</span>
  </div>
  <div class="sec-body">
    <div class="mgrid">
      <div class="metric-cell" data-key="DB">
        <div class="mlbl">D√≠vida Bruta <span class="minfo" onclick="showInfo('DB',event)">‚ìò</span></div>
        <div class="mval neg">R$ 312,8B</div>
        <div class="msub">‚ñ≤ +4,2% a.a.</div>
        <div class="mval-compare" id="cmp-DB"><span class="mval-compare-ticker" id="ct-DB"></span> ‚Äî</div>
        <div class="mann" onclick="openNote(this)">‚úé</div>
        <div class="mnote"><textarea placeholder="Sua anota√ß√£o..." rows="2" onblur="saveNote(this,'D√≠vida Bruta')"></textarea></div>
        <div class="chart-toggle-row">
          <button class="chart-toggle-btn" onclick="toggleChart(this,'DB')">Mostrar gr√°fico</button>
          <div class="chart-period-sel" id="psel-DB">
            <button class="period-btn active" onclick="setPeriod(this,'DB','A')">Anual</button>
            <button class="period-btn" onclick="setPeriod(this,'DB','1T')">1T</button>
            <button class="period-btn" onclick="setPeriod(this,'DB','2T')">2T</button>
            <button class="period-btn" onclick="setPeriod(this,'DB','3T')">3T</button>
            <button class="period-btn" onclick="setPeriod(this,'DB','4T')">4T</button>
            <span class="period-sep">|</span>
            <select class="year-sel" onchange="setYear(this,'DB')" id="ysel-DB"></select>
          </div>
        </div>
        <div class="chart-area" id="chart-DB"><div class="chart-wrap"><svg class="chart-svg" id="svg-DB"></svg><div class="chart-tooltip" id="tip-DB"></div></div></div>
      </div>
      <div class="metric-cell" data-key="DL">
        <div class="mlbl">D√≠vida L√≠quida <span class="minfo" onclick="showInfo('DL',event)">‚ìò</span></div>
        <div class="mval neg">R$ 198,4B</div>
        <div class="msub">Caixa: R$ 114,4B</div>
        <div class="mval-compare" id="cmp-DL"><span class="mval-compare-ticker" id="ct-DL"></span> ‚Äî</div>
        <div class="mann" onclick="openNote(this)">‚úé</div>
        <div class="mnote"><textarea placeholder="Sua anota√ß√£o..." rows="2" onblur="saveNote(this,'D√≠vida L√≠quida')"></textarea></div>
        <div class="chart-toggle-row">
          <button class="chart-toggle-btn" onclick="toggleChart(this,'DL')">Mostrar gr√°fico</button>
          <div class="chart-period-sel" id="psel-DL">
            <button class="period-btn active" onclick="setPeriod(this,'DL','A')">Anual</button>
            <button class="period-btn" onclick="setPeriod(this,'DL','1T')">1T</button>
            <button class="period-btn" onclick="setPeriod(this,'DL','2T')">2T</button>
            <button class="period-btn" onclick="setPeriod(this,'DL','3T')">3T</button>
            <button class="period-btn" onclick="setPeriod(this,'DL','4T')">4T</button>
            <span class="period-sep">|</span>
            <select class="year-sel" onchange="setYear(this,'DL')" id="ysel-DL"></select>
          </div>
        </div>
        <div class="chart-area" id="chart-DL"><div class="chart-wrap"><svg class="chart-svg" id="svg-DL"></svg><div class="chart-tooltip" id="tip-DL"></div></div></div>
      </div>
      <div class="metric-cell" data-key="ALAV">
        <div class="mlbl">Alavancagem DL/EBITDA <span class="minfo" onclick="showInfo('ALAV',event)">‚ìò</span></div>
        <div class="mval neu">0,71x</div>
        <div class="msub">2023: 0,58x</div>
        <div class="mval-compare" id="cmp-ALAV"><span class="mval-compare-ticker" id="ct-ALAV"></span> ‚Äî</div>
        <div class="mann" onclick="openNote(this)">‚úé</div>
        <div class="mnote"><textarea placeholder="Sua anota√ß√£o..." rows="2" onblur="saveNote(this,'Alavancagem')"></textarea></div>
        <div class="chart-toggle-row">
          <button class="chart-toggle-btn" onclick="toggleChart(this,'ALAV')">Mostrar gr√°fico</button>
          <div class="chart-period-sel" id="psel-ALAV">
            <button class="period-btn active" onclick="setPeriod(this,'ALAV','A')">Anual</button>
            <button class="period-btn" onclick="setPeriod(this,'ALAV','1T')">1T</button>
            <button class="period-btn" onclick="setPeriod(this,'ALAV','2T')">2T</button>
            <button class="period-btn" onclick="setPeriod(this,'ALAV','3T')">3T</button>
            <button class="period-btn" onclick="setPeriod(this,'ALAV','4T')">4T</button>
            <span class="period-sep">|</span>
            <select class="year-sel" onchange="setYear(this,'ALAV')" id="ysel-ALAV"></select>
          </div>
        </div>
        <div class="chart-area" id="chart-ALAV"><div class="chart-wrap"><svg class="chart-svg" id="svg-ALAV"></svg><div class="chart-tooltip" id="tip-ALAV"></div></div></div>
      </div>
      <div class="metric-cell" data-key="DPL">
        <div class="mlbl">D√≠vida / PL <span class="minfo" onclick="showInfo('DPL',event)">‚ìò</span></div>
        <div class="mval neu">1,48x</div>
        <div class="msub">2023: 1,32x</div>
        <div class="mval-compare" id="cmp-DPL"><span class="mval-compare-ticker" id="ct-DPL"></span> ‚Äî</div>
        <div class="mann" onclick="openNote(this)">‚úé</div>
        <div class="mnote"><textarea placeholder="Sua anota√ß√£o..." rows="2" onblur="saveNote(this,'D√≠vida/PL')"></textarea></div>
        <div class="chart-toggle-row">
          <button class="chart-toggle-btn" onclick="toggleChart(this,'DPL')">Mostrar gr√°fico</button>
          <div class="chart-period-sel" id="psel-DPL">
            <button class="period-btn active" onclick="setPeriod(this,'DPL','A')">Anual</button>
            <button class="period-btn" onclick="setPeriod(this,'DPL','1T')">1T</button>
            <button class="period-btn" onclick="setPeriod(this,'DPL','2T')">2T</button>
            <button class="period-btn" onclick="setPeriod(this,'DPL','3T')">3T</button>
            <button class="period-btn" onclick="setPeriod(this,'DPL','4T')">4T</button>
            <span class="period-sep">|</span>
            <select class="year-sel" onchange="setYear(this,'DPL')" id="ysel-DPL"></select>
          </div>
        </div>
        <div class="chart-area" id="chart-DPL"><div class="chart-wrap"><svg class="chart-svg" id="svg-DPL"></svg><div class="chart-tooltip" id="tip-DPL"></div></div></div>
      </div>
    </div>
  </div>
</div>

</div><!-- /content -->
</div><!-- /main -->

<!-- SIDEBAR TOGGLE -->
<div class="stoggle" id="stoggle" onclick="toggleSidebar()">‚Äπ</div>

<!-- SIDEBAR -->
<div class="sidebar" id="sidebar">
  <div class="stabs">
    <div class="stab active" onclick="switchTab('notes',this)">Anota√ß√µes</div>
    <div class="stab" onclick="switchTab('analysis',this)">An√°lise</div>
    <div class="stab" onclick="switchTab('saves',this)">Hist√≥rico</div>
  </div>

  <!-- NOTAS -->
  <div class="spanel active" id="panel-notes">
    <div class="notes-list" id="notesList">
      <div class="notes-empty" id="notesEmpty">
        <div class="notes-empty-ico">‚úé</div>
        <div>Clique no √≠cone ‚úé ao lado de qualquer m√©trica para anotar.</div>
      </div>
    </div>
    <div class="notes-foot">
      <div class="ai-sum-block" id="aiSumBlock"><div class="ai-sum-lbl">‚ú¶ Resumo IA</div><div id="aiSumText"></div></div>
      <button class="btn-ai" onclick="summarizeNotes()">‚ú¶ Resumir anota√ß√µes com IA</button>
    </div>
  </div>

  <!-- AN√ÅLISE -->
  <div class="spanel" id="panel-analysis">
    <div class="an-head">
      <div class="an-confirm"><div><div class="an-ticker">PETR4</div><div class="an-cname">Petr√≥leo Brasileiro S.A.</div></div></div>
      <input class="an-name-inp" type="text" placeholder="Nome da an√°lise (ex: Tese Longa ‚Äî Fev/26)">
    </div>
    <div class="an-body" id="anBody">
      <textarea class="an-editor" id="anEditor" placeholder="Escreva sua an√°lise. A IA sugere insights a cada 5 linhas escritas..." oninput="onAnInput(this)"></textarea>
      <div class="ai-insight" id="aiInsight"><div class="ai-ins-lbl">‚ú¶ Insight IA</div><div id="aiInsightText"></div></div>
    </div>
    <div class="an-foot">
      <button class="btn-calc" onclick="openModal('calc')">‚äû Calculadoras</button>
      <button class="btn-save" onclick="saveAnalysis()">Salvar an√°lise</button>
    </div>
  </div>

  <!-- HIST√ìRICO -->
  <div class="spanel" id="panel-saves">
    <div class="saves-list" id="savesList">
      <div class="notes-empty"><div class="notes-empty-ico">üìÅ</div><div>Nenhuma an√°lise salva ainda.</div></div>
    </div>
  </div>
</div>

<!-- MODAL CALCULADORAS -->
<div class="modal-ov" id="modal-calc">
  <div class="modal">
    <div class="modal-title">Calculadoras</div>
    <div class="calc-tabs">
      <div class="ctab active" onclick="switchCalc('graham',this)">Graham</div>
      <div class="ctab" onclick="switchCalc('peg',this)">PEG Ratio</div>
      <div class="ctab" onclick="switchCalc('dividendos',this)">Proj. Dividendos</div>
      <div class="ctab" onclick="switchCalc('custoMedio',this)">Custo M√©dio</div>
      <div class="ctab" onclick="switchCalc('valuation',this)">Valuation</div>
    </div>
    <div class="calc-body">

      <!-- GRAHAM -->
      <div class="calc-section active" id="cs-graham">
        <div class="crow">
          <div class="cfield"><label>LPA (Lucro por A√ß√£o)</label><input type="number" id="g-lpa" placeholder="ex: 8.00" oninput="calcGraham()"></div>
          <div class="cfield"><label>VPA (Valor Patrimonial)</label><input type="number" id="g-vpa" placeholder="ex: 32.00" oninput="calcGraham()"></div>
        </div>
        <div class="cresult">
          <div class="cres-lbl">Pre√ßo Justo Graham (‚àö22,5 √ó LPA √ó VPA)</div>
          <div class="cres-val" id="g-res">‚Äî</div>
          <div class="cres-sub" id="g-sub"></div>
        </div>
      </div>

      <!-- PEG -->
      <div class="calc-section" id="cs-peg">
        <div class="crow">
          <div class="cfield"><label>P/L atual</label><input type="number" id="peg-pl" placeholder="ex: 4.8" oninput="calcPeg()"></div>
          <div class="cfield"><label>Crescimento do Lucro (%)</label><input type="number" id="peg-g" placeholder="ex: 8" oninput="calcPeg()"></div>
        </div>
        <div class="cresult">
          <div class="cres-lbl">PEG Ratio (P/L √∑ Crescimento)</div>
          <div class="cres-val" id="peg-res">‚Äî</div>
          <div class="cres-sub" id="peg-sub">PEG &lt; 1 = potencialmente subvalorizado</div>
        </div>
      </div>

      <!-- DIVIDENDOS -->
      <div class="calc-section" id="cs-dividendos">
        <div class="crow">
          <div class="cfield"><label>Dividendo anual atual (R$)</label><input type="number" id="div-atual" placeholder="ex: 5.49" oninput="calcDiv()"></div>
          <div class="cfield"><label>Crescimento anual (%)</label><input type="number" id="div-g" placeholder="ex: 5" oninput="calcDiv()"></div>
        </div>
        <div class="crow">
          <div class="cfield"><label>Anos de proje√ß√£o</label><input type="number" id="div-anos" placeholder="ex: 10" oninput="calcDiv()" min="1" max="30"></div>
          <div class="cfield"><label>Pre√ßo de compra (R$)</label><input type="number" id="div-preco" placeholder="ex: 38.42" oninput="calcDiv()"></div>
        </div>
        <div class="cresult">
          <div class="cres-lbl">Dividendo projetado no ano final</div>
          <div class="cres-val" id="div-res">‚Äî</div>
          <div class="cres-sub" id="div-sub"></div>
        </div>
      </div>

      <!-- CUSTO M√âDIO -->
      <div class="calc-section" id="cs-custoMedio">
        <div id="cm-rows" style="display:flex;flex-direction:column;gap:9px;"></div>
        <button class="btn" onclick="addCmRow()" style="align-self:flex-start;margin-top:4px;font-size:.72rem;">+ Adicionar compra</button>
        <div class="cresult">
          <div class="cres-lbl">Custo M√©dio por A√ß√£o</div>
          <div class="cres-val" id="cm-res">‚Äî</div>
          <div class="cres-sub" id="cm-sub"></div>
        </div>
      </div>

      <!-- VALUATION -->
      <div class="calc-section" id="cs-valuation">
        <div class="cfield">
          <label>Modelo de valuation</label>
          <select id="val-modelo" onchange="switchValModel()">
            <option value="">Selecione um modelo</option>
            <option value="bazin">Bazin (DY m√≠nimo)</option>
            <option value="gordon">Gordon Growth Model</option>
            <option value="lynch">Peter Lynch Fair Value</option>
            <option value="greenblatt">Magic Formula (Greenblatt)</option>
          </select>
        </div>
        <div class="val-model-desc" id="val-desc" style="display:none"></div>
        <div id="val-inputs" style="display:flex;flex-direction:column;gap:10px;"></div>
        <div class="cresult" id="val-result" style="display:none">
          <div class="cres-lbl" id="val-res-lbl">Pre√ßo Justo</div>
          <div class="cres-val" id="val-res">‚Äî</div>
          <div class="cres-sub" id="val-sub"></div>
        </div>
      </div>

    </div>
    <button class="modal-close" onclick="closeModal('calc')">Fechar</button>
  </div>
</div>

<!-- MODAL INFO -->
<div class="modal-ov" id="modal-info">
  <div class="modal info-modal">
    <div class="info-title" id="infoTitle">‚Äî</div>
    <div class="info-subtitle" id="infoSubtitle">Indicador Fundamentalista</div>
    <div class="info-section">
      <div class="info-section-title">O que √©</div>
      <div class="info-text" id="infoWhat"></div>
    </div>
    <div class="info-section">
      <div class="info-section-title">Como analisar</div>
      <div class="info-text" id="infoHow"></div>
    </div>
    <div class="info-section">
      <div class="info-section-title">Limita√ß√µes</div>
      <div class="info-text" id="infoLimit"></div>
    </div>
    <button class="modal-close" onclick="closeModal('info')">Fechar</button>
  </div>
</div>

<!-- MODAL COMPARAR -->
<div class="modal-ov" id="modal-compare">
  <div class="modal" style="width:400px">
    <div class="modal-title">Comparar com outro ativo</div>
    <div class="comp-input">
      <input type="text" id="compInput" placeholder="Ex: VALE3" maxlength="6" oninput="this.value=this.value.toUpperCase()">
      <button onclick="applyCompare()">Comparar</button>
    </div>
    <p style="font-size:.76rem;color:var(--tx3);line-height:1.6">Os valores do ativo comparado aparecer√£o abaixo de cada m√©trica para facilitar a an√°lise lado a lado.</p>
    <button class="modal-close" onclick="closeModal('compare')">Cancelar</button>
  </div>
</div>

<script>
// ‚îÄ‚îÄ‚îÄ DATA ‚îÄ‚îÄ‚îÄ
const chartData = {};
const metrics = ['PL','PVP','EVEBITDA','DY','ROE','ROIC','ROA','MEBITDA','RL','LB','EBITDA','LL','DB','DL','ALAV','DPL'];
const baseValues = {PL:[9.2,7.4,5.1,4.2,4.8,5.6,4.8],PVP:[2.1,1.8,1.3,1.0,1.2,1.4,1.2],EVEBITDA:[6.8,5.4,3.9,3.2,3.6,4.0,3.6],DY:[8.2,5.1,11.4,14.8,13.2,12.1,14.3],ROE:[18.2,12.4,31.2,34.8,28.4,26.1,28.4],ROIC:[12.1,8.8,20.1,22.4,18.7,17.2,18.7],ROA:[6.2,4.1,10.5,11.8,9.2,8.6,9.2],MEBITDA:[44.2,38.8,52.4,56.1,54.8,51.2,54.8],RL:[380,320,460,510,512,498,512],LB:[210,175,255,290,286,272,286],EBITDA:[168,124,241,288,281,265,281],LL:[88,54,148,162,125,118,125],DB:[290,310,285,298,312,308,312],DL:[182,208,168,185,198,192,198],ALAV:[1.09,1.68,0.70,0.64,0.71,0.73,0.71],DPL:[1.72,2.14,1.24,1.30,1.48,1.42,1.48]};
const years = [2018,2019,2020,2021,2022,2023,2024,2025];
const quarters = {A:baseValues,1:null,2:null,3:null,4:null};
const metricState = {};
metrics.forEach(k => { metricState[k]={period:'A',year:2025,open:false}; generateQData(k); });
function generateQData(k){const b=baseValues[k];quarters[1]={};quarters[2]={};quarters[3]={};quarters[4]={};metrics.forEach(m=>{const bv=baseValues[m];[1,2,3,4].forEach(q=>{if(!quarters[q][m])quarters[q][m]=[];quarters[q][m]=bv.map((v,i)=>+(v*(0.88+Math.random()*.24)).toFixed(2));});});}

// YEAR SELECTS
metrics.forEach(k => {
  const sel = document.getElementById('ysel-'+k);
  if(!sel) return;
  for(let i=2025;i>=2018;i--){const o=document.createElement('option');o.value=i;o.textContent=i;sel.appendChild(o);}
});

function getChartVals(key, period, year){
  const yIdx = years.indexOf(parseInt(year));
  if(period==='A'){
    const end=yIdx<0?years.length:yIdx+1;
    return baseValues[key].slice(0,end).map((v,i)=>({v,label:String(years[i])}));
  }
  const q=parseInt(period.replace('T',''));
  const arr=quarters[q]&&quarters[q][key]?quarters[q][key]:baseValues[key];
  const end=yIdx<0?arr.length:yIdx+1;
  return arr.slice(0,end).map((v,i)=>({v,label:`${q}T/${String(years[i]).slice(2)}`}));
}

// CHART RENDER
function renderChart(key){
  const state=metricState[key];
  const data=getChartVals(key,state.period,state.year);
  if(!data.length)return;
  const svg=document.getElementById('svg-'+key);
  const tip=document.getElementById('tip-'+key);
  if(!svg)return;
  const W=svg.parentElement.offsetWidth||300, H=120;
  svg.setAttribute('viewBox',`0 0 ${W} ${H}`);
  const vals=data.map(d=>d.v);
  const mn=Math.min(...vals), mx=Math.max(...vals);
  const pad={t:14,b:22,l:8,r:8};
  const xScale=i=>(W-pad.l-pad.r)/(data.length-1)*i+pad.l;
  const yScale=v=>H-pad.b-(mx===mn?0.5:(v-mn)/(mx-mn))*(H-pad.t-pad.b);
  const pts=data.map((d,i)=>`${xScale(i)},${yScale(d.v)}`).join(' ');
  const fillPts=`${pad.l},${H-pad.b} `+pts+` ${xScale(data.length-1)},${H-pad.b}`;
  svg.innerHTML=`
    <defs>
      <linearGradient id="lg-${key}" x1="0" x2="0" y1="0" y2="1">
        <stop offset="0%" stop-color="rgba(196,154,108,0.3)"/>
        <stop offset="100%" stop-color="rgba(196,154,108,0)"/>
      </linearGradient>
    </defs>
    <polygon points="${fillPts}" fill="url(#lg-${key})"/>
    <polyline points="${pts}" fill="none" stroke="rgba(196,154,108,0.7)" stroke-width="1.5" stroke-linejoin="round" stroke-linecap="round"/>
    ${data.map((d,i)=>`
      <circle cx="${xScale(i)}" cy="${yScale(d.v)}" r="3.5" fill="var(--bg-card)" stroke="rgba(196,154,108,0.8)" stroke-width="1.5" class="dot"
        data-i="${i}" data-v="${d.v}" data-l="${d.label}"/>
    `).join('')}
    ${data.map((d,i)=>`
      <text x="${xScale(i)}" y="${H-4}" text-anchor="middle" font-size="9" fill="rgba(255,255,255,0.22)" font-family="DM Mono,monospace">${d.label}</text>
    `).join('')}
  `;
  svg.querySelectorAll('.dot').forEach(dot=>{
    dot.addEventListener('mouseenter',e=>{
      const i=parseInt(dot.dataset.i),v=parseFloat(dot.dataset.v),lbl=dot.dataset.l;
      const prev=i>0?vals[i-1]:null;
      const chg=prev!==null?((v-prev)/Math.abs(prev)*100).toFixed(1):null;
      const samePeriodPrev=i>0&&state.period!=='A'?vals[Math.max(0,i-1)]:null;
      let chgHtml='';
      if(chg!==null){const cls=parseFloat(chg)>=0?'pos':'neg';chgHtml=`<div class="ct-chg ${cls}">${parseFloat(chg)>=0?'‚ñ≤':'‚ñº'} ${Math.abs(chg)}% vs anterior</div>`;}
      tip.style.display='block';
      tip.innerHTML=`<div class="ct-date">${lbl}</div><div class="ct-val">${v}</div>${chgHtml}`;
      const svgRect=svg.getBoundingClientRect();
      const cx=parseFloat(dot.getAttribute('cx')),cy=parseFloat(dot.getAttribute('cy'));
      const scaleX=svgRect.width/W;
      let left=cx*scaleX+10, top=cy-40;
      if(left+150>svgRect.width)left=cx*scaleX-160;
      tip.style.left=left+'px'; tip.style.top=top+'px';
    });
    dot.addEventListener('mouseleave',()=>{ tip.style.display='none'; });
  });
}

// TOGGLE CHART
function toggleChart(btn, key){
  const area=document.getElementById('chart-'+key);
  const psel=document.getElementById('psel-'+key);
  const open=area.classList.toggle('visible');
  psel.classList.toggle('visible',open);
  btn.textContent=open?'Esconder gr√°fico':'Mostrar gr√°fico';
  btn.classList.toggle('active',open);
  metricState[key].open=open;
  if(open) setTimeout(()=>renderChart(key),20);
}

function setPeriod(btn, key, p){
  document.querySelectorAll(`#psel-${key} .period-btn`).forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  metricState[key].period=p;
  if(metricState[key].open) renderChart(key);
}

function setYear(sel, key){
  metricState[key].year=parseInt(sel.value);
  if(metricState[key].open) renderChart(key);
}

// ‚îÄ‚îÄ‚îÄ SECTION COLLAPSE ‚îÄ‚îÄ‚îÄ
function toggleSec(hd){
  const body=hd.nextElementSibling;
  const arr=hd.querySelector('.sec-arr');
  const hidden=body.style.display==='none';
  body.style.display=hidden?'':'none';
  arr.classList.toggle('open',hidden);
  hd.classList.toggle('collapsed',!hidden);
}

// ‚îÄ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ‚îÄ
let sbOpen=false;
function toggleSidebar(){
  sbOpen=!sbOpen;
  document.getElementById('sidebar').classList.toggle('open',sbOpen);
  document.getElementById('main').classList.toggle('open',sbOpen);
  const t=document.getElementById('stoggle');
  t.classList.toggle('open',sbOpen);
  t.textContent=sbOpen?'‚Ä∫':'‚Äπ';
}
function switchTab(name,el){
  document.querySelectorAll('.stab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.spanel').forEach(p=>p.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('panel-'+name).classList.add('active');
}

// ‚îÄ‚îÄ‚îÄ NOTES ‚îÄ‚îÄ‚îÄ
const notes={};
function openNote(btn){
  const cell=btn.closest('.metric-cell');
  const note=cell.querySelector('.mnote');
  note.classList.toggle('visible');
  if(note.classList.contains('visible')) note.querySelector('textarea').focus();
}
function saveNote(ta, label){
  const txt=ta.value.trim();
  if(txt){ notes[label]=txt; renderNotes(); }
}
function renderNotes(){
  const list=document.getElementById('notesList');
  const empty=document.getElementById('notesEmpty');
  const keys=Object.keys(notes);
  if(!keys.length){empty.style.display='';return;}
  empty.style.display='none';
  const existing=list.querySelectorAll('.note-card');
  existing.forEach(c=>c.remove());
  keys.forEach(k=>{
    const c=document.createElement('div');
    c.className='note-card';
    c.innerHTML=`<div class="note-origin">${k}</div><div class="note-text">${notes[k]}</div>`;
    list.appendChild(c);
  });
}
const sumPool=["P/L abaixo do setor (4,8x vs 7,2x) ‚Äî desconto pode refletir risco pol√≠tico. Cruze com a tend√™ncia de queda no lucro l√≠quido (-8,1% a.a.).","ROE em queda estrutural (31% ‚Üí 28%) com alavancagem crescente. Verifique custo da d√≠vida vs. retorno gerado.","Dividend Yield de 14,3% com payout elevado ‚Äî analise se o fluxo de caixa livre sustenta a distribui√ß√£o no m√©dio prazo."];
function summarizeNotes(){
  const b=document.getElementById('aiSumBlock');
  document.getElementById('aiSumText').textContent=sumPool[Math.floor(Math.random()*sumPool.length)];
  b.classList.add('visible');
}

// ‚îÄ‚îÄ‚îÄ ANALYSIS ‚îÄ‚îÄ‚îÄ
let lastLine=0, insIdx=0;
const insightPool=["Dividend Yield de 14,3% com lucro em queda ‚Äî verifique payout ratio e sustentabilidade.","P/L 4,8x com ROE 28,4%: mercado precifica crescimento baixo. Consistente com sua tese?","Alavancagem crescendo com caixa robusto ‚Äî cruze com cronograma de vencimento da d√≠vida.","Margem EBITDA (54,8%) acima do setor: vantagem competitiva ou benef√≠cio regulat√≥rio tempor√°rio?","ROIC (18,7%) acima do custo de capital estimado (~12%): gera√ß√£o de valor ainda positiva."];
function onAnInput(ta){
  const lines=ta.value.split('\n').filter(l=>l.trim()).length;
  if(lines>0&&lines%5===0&&lines!==lastLine){lastLine=lines;showInsight();}
}
function showInsight(){
  const el=document.getElementById('aiInsight');
  document.getElementById('aiInsightText').textContent=insightPool[insIdx%insightPool.length];
  insIdx++;
  el.style.display='block';
}
const saves=[];
function saveAnalysis(){
  const name=document.querySelector('.an-name-inp').value||'An√°lise PETR4';
  const text=document.getElementById('anEditor').value;
  if(!text.trim()){alert('Escreva sua an√°lise antes de salvar.');return;}
  saves.unshift({name,text,date:new Date().toLocaleDateString('pt-BR',{day:'2-digit',month:'short',year:'numeric'})});
  renderSaves();
  const btn=document.querySelector('.btn-save');
  btn.textContent='‚úì Salvo';
  setTimeout(()=>{btn.textContent='Salvar an√°lise';},2000);
  switchTab('saves',document.querySelectorAll('.stab')[2]);
}
function renderSaves(){
  const list=document.getElementById('savesList');
  list.innerHTML='';
  if(!saves.length){list.innerHTML='<div class="notes-empty"><div class="notes-empty-ico">üìÅ</div><div>Nenhuma an√°lise salva ainda.</div></div>';return;}
  saves.forEach((s,i)=>{
    const c=document.createElement('div');
    c.className='save-card';
    c.innerHTML=`<div class="save-card-name">${s.name}</div><div class="save-card-meta"><span>PETR4</span>${s.date}</div><div class="save-card-preview">${s.text}</div>`;
    c.onclick=()=>{
      document.querySelector('.an-name-inp').value=s.name;
      document.getElementById('anEditor').value=s.text;
      switchTab('analysis',document.querySelectorAll('.stab')[1]);
    };
    list.appendChild(c);
  });
}

// ‚îÄ‚îÄ‚îÄ COMPARE ‚îÄ‚îÄ‚îÄ
let compareActive=false, compareTicker='';
const compareData={PL:'3,2x',PVP:'2,1x',EVEBITDA:'4,8x',DY:'4,2%',ROE:'21,4%',ROIC:'14,8%',ROA:'7,8%',MEBITDA:'42,1%',RL:'R$ 196,2B',LB:'R$ 82,4B',EBITDA:'R$ 82,6B',LL:'R$ 46,8B',DB:'R$ 148,4B',DL:'R$ 62,8B',ALAV:'0,76x',DPL:'0,88x'};
const compareNames={VALE3:'Vale S.A.',ITUB4:'Ita√∫ Unibanco',BBDC4:'Bradesco',ABEV3:'Ambev S.A.',WEGE3:'WEG S.A.'};
function openCompare(){ openModal('compare'); }
function applyCompare(){
  compareTicker=document.getElementById('compInput').value.trim().toUpperCase();
  if(!compareTicker){return;}
  compareActive=true;
  const name=compareNames[compareTicker]||compareTicker;
  document.getElementById('compTickerBadge').textContent=compareTicker;
  document.getElementById('compName').textContent=name;
  document.getElementById('compareBanner').classList.add('visible');
  metrics.forEach(k=>{
    const el=document.getElementById('cmp-'+k);
    const ct=document.getElementById('ct-'+k);
    if(el){
      ct.textContent=compareTicker+': ';
      el.querySelector('span').nextSibling.textContent=compareData[k]||'‚Äî';
      el.classList.add('visible');
    }
  });
  closeModal('compare');
}
function removeCompare(){
  compareActive=false;
  document.getElementById('compareBanner').classList.remove('visible');
  metrics.forEach(k=>{
    const el=document.getElementById('cmp-'+k);
    if(el) el.classList.remove('visible');
  });
}

// ‚îÄ‚îÄ‚îÄ MODALS ‚îÄ‚îÄ‚îÄ
function openModal(name){ document.getElementById('modal-'+name).classList.add('open'); }
function closeModal(name){ document.getElementById('modal-'+name).classList.remove('open'); }
document.querySelectorAll('.modal-ov').forEach(ov=>ov.addEventListener('click',e=>{if(e.target===ov)ov.classList.remove('open');}));

// ‚îÄ‚îÄ‚îÄ CALCS ‚îÄ‚îÄ‚îÄ
function switchCalc(name, el){
  document.querySelectorAll('.ctab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.calc-section').forEach(s=>s.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('cs-'+name).classList.add('active');
}
function calcGraham(){
  const lpa=parseFloat(document.getElementById('g-lpa').value);
  const vpa=parseFloat(document.getElementById('g-vpa').value);
  const res=document.getElementById('g-res');
  const sub=document.getElementById('g-sub');
  if(lpa>0&&vpa>0){const pj=Math.sqrt(22.5*lpa*vpa);res.textContent='R$ '+pj.toFixed(2);sub.textContent='Pre√ßo atual: R$ 38,42 ‚Äî '+(38.42<=pj?'potencial de valoriza√ß√£o de '+((pj/38.42-1)*100).toFixed(1)+'%':'acima do pre√ßo justo');}
  else{res.textContent='‚Äî';sub.textContent='';}
}
function calcPeg(){
  const pl=parseFloat(document.getElementById('peg-pl').value);
  const g=parseFloat(document.getElementById('peg-g').value);
  const res=document.getElementById('peg-res');
  if(pl>0&&g>0){const peg=pl/g;res.textContent=peg.toFixed(2)+'x';document.getElementById('peg-sub').textContent=peg<1?'Potencialmente subvalorizado (PEG < 1)':peg<2?'Avalia√ß√£o razo√°vel (PEG entre 1 e 2)':'Potencialmente sobrevalorizado (PEG > 2)';}
  else{res.textContent='‚Äî';}
}
function calcDiv(){
  const d=parseFloat(document.getElementById('div-atual').value);
  const g=parseFloat(document.getElementById('div-g').value)/100;
  const n=parseInt(document.getElementById('div-anos').value);
  const p=parseFloat(document.getElementById('div-preco').value);
  const res=document.getElementById('div-res');
  const sub=document.getElementById('div-sub');
  if(d>0&&!isNaN(g)&&n>0){
    const df=d*Math.pow(1+g,n);
    res.textContent='R$ '+df.toFixed(2)+'/a√ß√£o';
    if(p>0){const yoc=df/p*100;sub.textContent='Yield on Cost no ano '+n+': '+yoc.toFixed(1)+'%';}
  } else {res.textContent='‚Äî';sub.textContent='';}
}

// CUSTO M√âDIO
let cmRows=[];
function addCmRow(){
  const idx=cmRows.length;
  cmRows.push({qtd:0,preco:0});
  const cont=document.getElementById('cm-rows');
  const row=document.createElement('div');
  row.className='crow';
  row.innerHTML=`<div class="cfield"><label>Qtd. de a√ß√µes</label><input type="number" placeholder="ex: 100" oninput="updateCm(${idx},'qtd',this.value)"></div><div class="cfield"><label>Pre√ßo pago (R$)</label><input type="number" placeholder="ex: 35.20" oninput="updateCm(${idx},'preco',this.value)"></div>`;
  cont.appendChild(row);
  calcCm();
}
function updateCm(i,field,v){cmRows[i][field]=parseFloat(v)||0;calcCm();}
function calcCm(){
  const totalQtd=cmRows.reduce((a,r)=>a+r.qtd,0);
  const totalVal=cmRows.reduce((a,r)=>a+r.qtd*r.preco,0);
  const res=document.getElementById('cm-res');
  const sub=document.getElementById('cm-sub');
  if(totalQtd>0){
    const cm=totalVal/totalQtd;
    res.textContent='R$ '+cm.toFixed(2);
    sub.textContent=totalQtd+' a√ß√µes ‚Äî Total: R$ '+totalVal.toFixed(2);
  } else {res.textContent='‚Äî';sub.textContent='';}
}
// init cm row
addCmRow();

// VALUATION MODELS
const valModels={
  bazin:{desc:'O m√©todo de Bazin define o pre√ßo justo como aquele em que o Dividend Yield alcan√ßa pelo menos 6% ao ano. Funciona bem para empresas pagadoras consistentes.',inputs:[{id:'baz-div',label:'Dividendo anual esperado (R$)',ph:'ex: 5.49'}],calc:()=>{const d=parseFloat(document.getElementById('baz-div').value);return d>0?{val:(d/0.06).toFixed(2),lbl:'Pre√ßo Justo Bazin (DY = 6%)'}:{};} },
  gordon:{desc:'O Modelo de Gordon calcula o valor presente de dividendos crescendo perpetuamente. Adequado para empresas maduras com dividendos est√°veis.',inputs:[{id:'gor-d',label:'Dividendo por a√ß√£o (R$)',ph:'ex: 5.49'},{id:'gor-k',label:'Taxa de desconto (%) ‚Äî Custo do capital',ph:'ex: 12'},{id:'gor-g',label:'Crescimento perp√©tuo (%)',ph:'ex: 4'}],calc:()=>{const d=parseFloat(document.getElementById('gor-d').value),k=parseFloat(document.getElementById('gor-k').value)/100,g=parseFloat(document.getElementById('gor-g').value)/100;return(d&&k&&g&&k>g)?{val:(d/(k-g)).toFixed(2),lbl:'Pre√ßo Justo Gordon Growth'}:{};}},
  lynch:{desc:'Peter Lynch sugere que uma empresa bem precificada tem P/L igual √† sua taxa de crescimento. P/L justo = taxa de crescimento esperada do lucro.',inputs:[{id:'ly-g',label:'Crescimento do Lucro esperado (%)',ph:'ex: 8'},{id:'ly-lpa',label:'LPA (Lucro por A√ß√£o)',ph:'ex: 8.00'}],calc:()=>{const g=parseFloat(document.getElementById('ly-g').value),lpa=parseFloat(document.getElementById('ly-lpa').value);return(g&&lpa)?{val:(g*lpa).toFixed(2),lbl:'Pre√ßo Justo Peter Lynch'}:{};}},
  greenblatt:{desc:'A Magic Formula de Greenblatt seleciona empresas com alto ROIC e alto Earnings Yield. O pre√ßo justo √© estimado pelo EV impl√≠cito com ROIC alvo.',inputs:[{id:'gbl-ebit',label:'EBIT anual (R$)',ph:'ex: 280'},{id:'gbl-cic',label:'Capital Investido (R$)',ph:'ex: 500'},{id:'gbl-acoes',label:'N√∫mero de a√ß√µes (milh√µes)',ph:'ex: 13000'}],calc:()=>{const ebit=parseFloat(document.getElementById('gbl-ebit').value),cic=parseFloat(document.getElementById('gbl-cic').value),acoes=parseFloat(document.getElementById('gbl-acoes').value);if(ebit&&cic&&acoes){const ev=ebit/0.15,pj=(ev/acoes).toFixed(2);return{val:pj,lbl:'Pre√ßo Justo Magic Formula (ROIC alvo 15%)'};}return{};}},
};
function switchValModel(){
  const sel=document.getElementById('val-modelo').value;
  const desc=document.getElementById('val-desc');
  const inp=document.getElementById('val-inputs');
  const res=document.getElementById('val-result');
  if(!sel){desc.style.display='none';inp.innerHTML='';res.style.display='none';return;}
  const m=valModels[sel];
  desc.style.display='block'; desc.textContent=m.desc;
  inp.innerHTML=m.inputs.map(f=>`<div class="cfield"><label>${f.label}</label><input type="number" id="${f.id}" placeholder="${f.ph}" oninput="calcValuation()"></div>`).join('');
  res.style.display='block';
  document.getElementById('val-res').textContent='‚Äî';
}
function calcValuation(){
  const sel=document.getElementById('val-modelo').value;
  if(!sel)return;
  const r=valModels[sel].calc();
  if(r.val){
    document.getElementById('val-res').textContent='R$ '+r.val;
    document.getElementById('val-res-lbl').textContent=r.lbl||'Pre√ßo Justo';
    const pj=parseFloat(r.val);
    document.getElementById('val-sub').textContent=pj>0?'Pre√ßo atual: R$ 38,42 ‚Äî '+(38.42<=pj?'upside de '+((pj/38.42-1)*100).toFixed(1)+'%':'acima do pre√ßo justo'):'';
  }
}

// ‚îÄ‚îÄ‚îÄ INFO DATABASE ‚îÄ‚îÄ‚îÄ
const infoDB={
  PL:{title:'P/L ‚Äî Pre√ßo/Lucro',sub:'Indicador de Valuation',what:'Relaciona o pre√ßo de mercado da a√ß√£o com o lucro por a√ß√£o gerado pela empresa. Indica quanto o mercado paga por cada R$ 1 de lucro.',how:'P/L baixo pode indicar subvaloriza√ß√£o ou expectativa de queda nos lucros. P/L alto pode indicar crescimento esperado ou sobrevaloriza√ß√£o. Compare sempre com o hist√≥rico da empresa e com o setor.',limit:'N√£o funciona bem para empresas com lucro negativo. Em setores c√≠clicos, um P/L aparentemente baixo pode ocorrer no pico do ciclo.'},
  PVP:{title:'P/VP ‚Äî Pre√ßo/Valor Patrimonial',sub:'Indicador de Valuation',what:'Compara o pre√ßo de mercado com o valor patrimonial por a√ß√£o (patrim√¥nio l√≠quido √∑ a√ß√µes). Indica se o mercado valora a empresa acima ou abaixo do seu patrim√¥nio cont√°bil.',how:'P/VP < 1 pode indicar desconto sobre o valor dos ativos. P/VP > 1 indica √°gio ‚Äî o mercado reconhece valor al√©m do balan√ßo. Essencial para bancos e seguradoras.',limit:'O valor patrimonial cont√°bil pode n√£o refletir o valor real dos ativos, especialmente em empresas intensivas em intang√≠veis.'},
  EVEBITDA:{title:'EV/EBITDA',sub:'Indicador de Valuation',what:'Raz√£o entre o Valor da Empresa (Enterprise Value) e o EBITDA. O EV inclui d√≠vida l√≠quida + valor de mercado, representando o "pre√ßo total" da empresa.',how:'Permite comparar empresas com estruturas de capital diferentes. Valores abaixo da m√©dia hist√≥rica ou do setor podem indicar desconto. Amplamente usado em M&A.',limit:'Ignora varia√ß√µes no capital de giro e capex. Empresas com alto capex recorrente (como Petrobras) podem parecer mais baratas do que realmente s√£o.'},
  DY:{title:'Dividend Yield',sub:'Indicador de Retorno',what:'Percentual do pre√ßo da a√ß√£o distribu√≠do em dividendos nos √∫ltimos 12 meses. Mede a renda passiva gerada pelo investimento.',how:'DY elevado pode ser atrativo para renda, mas verifique se √© sustent√°vel. Calcule o payout ratio e verifique se o lucro e o fluxo de caixa suportam a distribui√ß√£o.',limit:'DY alto pode resultar de queda no pre√ßo da a√ß√£o (mau sinal) ou de lucro extraordin√°rio n√£o recorrente.'},
  ROE:{title:'ROE ‚Äî Retorno sobre o Patrim√¥nio',sub:'Indicador de Rentabilidade',what:'Mede o lucro gerado pela empresa em rela√ß√£o ao patrim√¥nio l√≠quido dos acionistas. ROE = Lucro L√≠quido √∑ Patrim√¥nio L√≠quido.',how:'ROE acima de 15% √© geralmente considerado bom. Tend√™ncia de alta √© sinal positivo. Compare com o custo de capital: se ROE > Ke, a empresa gera valor.',limit:'Alavancagem financeira elevada pode inflar artificialmente o ROE. Use em conjunto com ROIC para uma vis√£o mais completa.'},
  ROIC:{title:'ROIC ‚Äî Retorno sobre o Capital Investido',sub:'Indicador de Rentabilidade',what:'Mede a efici√™ncia com que a empresa usa todo o capital investido (d√≠vida + equity) para gerar lucro operacional. ROIC = NOPAT √∑ Capital Investido.',how:'ROIC > WACC (custo m√©dio do capital) indica gera√ß√£o de valor. √â o indicador preferido por analistas focados em qualidade de neg√≥cios.',limit:'Exige ajustes cont√°beis para ser calculado corretamente. Pode variar muito em setores com ativos intang√≠veis relevantes.'},
  ROA:{title:'ROA ‚Äî Retorno sobre os Ativos',sub:'Indicador de Rentabilidade',what:'Mede o lucro gerado em rela√ß√£o ao total de ativos da empresa. ROA = Lucro L√≠quido √∑ Ativo Total.',how:'√ötil para comparar efici√™ncia entre empresas do mesmo setor. Para bancos, um ROA de 1-2% j√° √© considerado bom. Para industriais, espera-se mais.',limit:'Ativos intang√≠veis n√£o contabilizados (marcas, patentes) podem distorcer o indicador.'},
  MEBITDA:{title:'Margem EBITDA',sub:'Indicador de Rentabilidade',what:'Percentual da receita que se converte em EBITDA. Mede a efici√™ncia operacional antes de juros, impostos, deprecia√ß√£o e amortiza√ß√£o.',how:'Margem alta e crescente indica poder de precifica√ß√£o e controle de custos. Compare com concorrentes e com o hist√≥rico da empresa.',limit:'Ignora capex e varia√ß√µes de capital de giro. Uma empresa pode ter margem EBITDA alta mas queimar caixa se o capex for muito elevado.'},
  RL:{title:'Receita L√≠quida',sub:'Indicador de Resultado',what:'Total das vendas deduzidas de impostos, devolu√ß√µes e descontos. √â a linha de partida da demonstra√ß√£o de resultados.',how:'Crescimento consistente da receita indica demanda s√≥lida. Analise junto com as margens para entender se o crescimento √© rent√°vel.',limit:'Crescimento de receita sem crescimento de lucro pode indicar deteriora√ß√£o das margens ou aumento de custos.'},
  LB:{title:'Lucro Bruto',sub:'Indicador de Resultado',what:'Receita L√≠quida menos o Custo dos Produtos Vendidos (CPV). Representa a rentabilidade antes das despesas operacionais.',how:'A margem bruta (Lucro Bruto √∑ Receita) indica o poder de precifica√ß√£o da empresa. Margens est√°veis ou crescentes s√£o positivas.',limit:'Varia muito por setor. Varejistas t√™m margens brutas menores que empresas de software, por exemplo.'},
  EBITDA:{title:'EBITDA',sub:'Indicador de Resultado',what:'Lucro antes de juros, impostos, deprecia√ß√£o e amortiza√ß√£o. Aproxima a gera√ß√£o de caixa operacional da empresa.',how:'Permite comparar empresas com diferentes estruturas de capital e regimes fiscais. Crescimento consistente √© sinal positivo.',limit:'N√£o √© fluxo de caixa livre. Ignora necessidades de reinvestimento (capex). Warren Buffett √© cr√≠tico do uso isolado deste indicador.'},
  LL:{title:'Lucro L√≠quido',sub:'Indicador de Resultado',what:'Resultado final ap√≥s todas as despesas, juros e impostos. √â a base para o c√°lculo do LPA (Lucro por A√ß√£o) e do ROE.',how:'Analise a tend√™ncia plurianual, n√£o um resultado isolado. Verifique itens n√£o recorrentes que possam distorcer o resultado.',limit:'Pode ser influenciado por eventos n√£o recorrentes, varia√ß√µes cambiais e diferimentos cont√°beis.'},
  DB:{title:'D√≠vida Bruta',sub:'Indicador de Endividamento',what:'Total de obriga√ß√µes financeiras da empresa com credores, incluindo empr√©stimos, deb√™ntures e financiamentos de curto e longo prazo.',how:'Analise em rela√ß√£o ao EBITDA e ao Patrim√¥nio L√≠quido. Tend√™ncia de crescimento acima da gera√ß√£o de caixa √© sinal de alerta.',limit:'Nem toda d√≠vida √© igual ‚Äî verifique custo, prazo e moeda da d√≠vida para avaliar o real risco.'},
  DL:{title:'D√≠vida L√≠quida',sub:'Indicador de Endividamento',what:'D√≠vida Bruta menos o Caixa e Equivalentes. Representa a d√≠vida efetiva caso a empresa usasse todo o caixa dispon√≠vel para quit√°-la.',how:'DL negativa (caixa > d√≠vida) indica posi√ß√£o de caixa l√≠quida ‚Äî geralmente positivo. DL/EBITDA > 3x √© considerado alto para a maioria dos setores.',limit:'O caixa pode ser restrito ou destinado a obriga√ß√µes espec√≠ficas. D√≠vida com garantias ou covenants exige an√°lise adicional.'},
  ALAV:{title:'Alavancagem (DL/EBITDA)',sub:'Indicador de Endividamento',what:'Quantos anos de EBITDA seriam necess√°rios para quitar a D√≠vida L√≠quida. √â o principal indicador de risco financeiro de cr√©dito.',how:'< 1x: muito conservador. 1-2x: saud√°vel. 2-3x: razo√°vel. > 3x: alto para a maioria dos setores. Ag√™ncias de rating usam este indicador extensamente.',limit:'Setores intensivos em ativos (energia, telecom, utilities) naturalmente operam com alavancagens mais altas por conta de fluxos de caixa previs√≠veis.'},
  DPL:{title:'D√≠vida / Patrim√¥nio L√≠quido',sub:'Indicador de Endividamento',what:'Rela√ß√£o entre a d√≠vida total e o patrim√¥nio l√≠quido dos acionistas. Indica quanto a empresa deve para cada R$ 1 de patrim√¥nio dos s√≥cios.',how:'< 1x √© geralmente conservador. Valores acima de 2x merecem aten√ß√£o. Compare com o hist√≥rico e com o setor.',limit:'Em per√≠odos de juros baixos, empresas alavancadas podem superar desalavancadas. A an√°lise de qualidade da d√≠vida √© essencial.'},
};
function showInfo(key, e){
  e.stopPropagation();
  const d=infoDB[key];
  if(!d)return;
  document.getElementById('infoTitle').textContent=d.title;
  document.getElementById('infoSubtitle').textContent=d.sub;
  document.getElementById('infoWhat').textContent=d.what;
  document.getElementById('infoHow').textContent=d.how;
  document.getElementById('infoLimit').textContent=d.limit;
  openModal('info');
}

// METRIC CELL class
document.querySelectorAll('.metric-cell').forEach(c=>c.classList.add('mcell'));

// init
window.addEventListener('resize',()=>{
  metrics.forEach(k=>{ if(metricState[k]&&metricState[k].open) renderChart(k); });
});
</script>
</body>
</html>